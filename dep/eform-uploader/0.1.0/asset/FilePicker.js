/*! 2016 Baidu Inc. All Rights Reserved */
define("eform-lang/format",[],function(){function e(e){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!e)return e;else return e.replace(t,function(e,t){for(var n=t.split("."),r=i[n.shift()];n.length&&null!=r;)r=r[n.shift()];return null==r?"":r})}var t=/\$\{(.+?)\}/g;return e}),define("eform-lang/noop",[],function(){var e=function(){};return e}),define("eform-lang/extend",[],function(){function e(e,t){if(e=e||{},arguments.length<=1)return e;for(var i=1;i<arguments.length;i++)if(t=arguments[i],null!=t)for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&void 0!==t[n])e[n]=t[n];return e}return e}),define("eform-lang/inherits",["require","./noop","./extend"],function(require){function e(e,n){t.prototype=n.prototype;var r=e.prototype,o=e.prototype=new t;return t.prototype={},i(o,r),e.prototype.constructor=e,e}var t=require("./noop"),i=require("./extend");return e}),define("eform-uploader/client/Runtime",["require","eform-lang","eform-emitter"],function(require){function e(e,t,n){this.guid=this.guid||i(),this.options=n,this.picker=e,this.component=t,this.disposed=!1,this.init(n)}var t=require("eform-lang").noop,i=require("eform-lang").guid,n=require("eform-emitter"),r=[].slice;return e.prototype={constructor:e,init:t,exec:function(){var e=r.call(arguments);return e.unshift(this.component),e.unshift(this.guid),this.picker.exec.apply(this.picker,e)},dispose:function(){if(!this.disposed)this.exec("destroy"),this.picker.unregister(this.guid),this.picker=null,this.disposed=!0}},n.mixin(e.prototype),e}),define("eform-uploader/client/Blob",["require","eform-lang/inherits","eform-lang","./Runtime"],function(require){function e(e,t,i){if(this.source=i,this.guid=i.uid,this.type=i.type||"application/octet-stream",!i.type&&r.test(i.name)){var o=RegExp.$1.toLowerCase();this.type="image/"+("jpg"===o?"jpeg":o)}this.size=i.size||0,this.tasks=[],this.running=!1,n.call(this,e,t,null)}var t=require("eform-lang/inherits"),i=require("eform-lang").bind,n=require("./Runtime"),r=/\.(jpeg|jpg|bmp|png|gif)$/i;return e.prototype={constructor:e,getSource:function(){return this.source},run:function(e){if(this.tasks.push(e),!this.running)this.next()},next:function(){var e=this;if(e.tasks.length){var t=e.tasks.shift();e.running=!0,setTimeout(function(){t.call(e)},0)}else e.running=!1},compress:function(e,t,n){var r=this,o=this.picker.register("Image",e);if(!this.type.match(/^image\/(?:jpeg|jpg)/))setTimeout(function(){o.dispose(),o.fire("data",r.slice())},0);else o.on("load error",i(this.next,this)),o.on("load",function(){var e=o.info;if(1>=t&&t>0)t=e.width*t;if(1>=n&&n>0)n=e.height*n;o.resize(t,n)}),o.on("error",function(){o.dispose()}),o.on("complete",function(){var e=o.getAsBlob("image/jpeg");if(e.size<r.size)o.fire("data",e);else o.fire("data",r.slice()),e.dispose();o.dispose()}),this.run(function(){o.loadFromBlob(this)});return o},md5:function(){var e=this.picker.register("MD5");return e.on("load error",i(this.next,this)),e.on("error",function(){e.dispose()}),e.on("complete",function(){e.fire("data",e.getResult()),e.dispose()}),this.run(function(){e.loadFromBlob(this)}),e},slice:function(t,i){return new e(this.picker,"Blob",this.exec("slice",t,i))},thumb:function(e,t,n){var r=this.picker.register("Image",e);if(!this.type.match(/^image/))setTimeout(function(){r.dispose(),r.fire("error","只能压缩图片格式")},0);else r.on("load error",i(this.next,this)),r.on("load",function(){var e=r.info;if(1>=t&&t>0)t=e.width*t;if(1>=n&&n>0)n=e.height*n;r.resize(t,n)}),r.on("error",function(){r.dispose()}),r.on("complete",function(){r.fire("data",r.getAsDataUrl("image/jpeg")),r.dispose()}),this.run(function(){r.loadFromBlob(this)});return r},transport:function(e){var t=this.picker.register("Transport",e);return t.on("load error",i(this.next,this)),t.on("error",function(){t.dispose()}),t.on("complete",function(e,i){t.fire("data",i),t.dispose()}),this.run(function(){t.send(this)}),t},dispose:function(){this.run(function(){n.prototype.dispose.call(this)})}},t(e,n),e}),define("eform-uploader/client/File",["require","eform-lang/inherits","./Blob"],function(require){function e(e,t,r){i.call(this,e,"Blob",r),this.name=r.name||"Untitled",this.lastModifiedDate=r.lastModifiedDate||new Date,this.ext=n.exec(this.name)?RegExp.$1.toLowerCase():"",this.hash=null}var t=require("eform-lang/inherits"),i=require("./Blob"),n=/\.([^.]+)$/;return e.prototype={constructor:e,getHash:function(){if(null==this.hash){for(var e=this.name+this.size+this.lastModifiedDate,t=0,i=0,n=e.length;n>i;i++){var r=e.charCodeAt(i);t=r+(t<<6)+(t<<16)-t}this.hash=t}return this.hash}},t(e,i),e}),define("eform-uploader/client/Image",["require","eform-lang/inherits","eform-lang","./Runtime","./Blob"],function(require){function e(e,t,r){r=i({},o,r),this.on("load",function(){this.info=this.exec("info"),this.meta=this.exec("meta")}),this.info=null,this.meta=null,n.call(this,e,t,r)}var t=require("eform-lang/inherits"),i=require("eform-lang").extend,n=require("./Runtime"),r=require("./Blob"),o={quality:90,crop:!0,preserveHeaders:!1,allowMagnify:!1};return e.prototype={loadFromBlob:function(e){this.exec("init",this.options),this.exec("loadFromBlob",e.guid)},resize:function(e,t){this.exec("resize",e,t)},getAsDataUrl:function(e){return this.exec("getAsDataUrl",e)},getAsBlob:function(e){return new r(this.picker,"Blob",this.exec("getAsBlob",e))}},t(e,n),e}),define("eform-uploader/client/MD5",["require","eform-lang/inherits","./Runtime"],function(require){function e(e,t,n){i.call(this,e,"Md5",n)}var t=require("eform-lang/inherits"),i=require("./Runtime");return e.prototype={loadFromBlob:function(e){this.exec("init"),this.exec("loadFromBlob",e.guid)},getResult:function(){return this.exec("getResult")}},t(e,i),e}),define("eform-lang/type",[],function(){function e(e){if(null==e)return e+"";if("object"==typeof e||"function"==typeof e)return t[i.call(e)]||"object";else return typeof e}var t={},i=t.toString;return"Boolean Number String Function Array Date RegExp Object Error".replace(/\w+/g,function(e){t["[object "+e+"]"]=e.toLowerCase()}),e}),define("eform-lang/each",["require","./type"],function(require){function e(e,i){if("array"===t(e))for(var n=e.length,r=0;n>r;r++){var o=i.call(e[r],r,e[r]);if(o===!1)break}else for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var s=i.call(e[a],a,e[a]);if(s===!1)break}return e}var t=require("./type");return e}),define("eform-lang/param",["require","./each","./type"],function(require){function e(e,t){if("function"===r(t))t=t();return t=null==t?"":t+"",encodeURIComponent(e)+"="+encodeURIComponent(t)}function t(i,a,s,l){var h=r(a);if("array"===h)n(a,function(n,r){if(s||o.test(i))l.push(e(i,r));else{var a=i+"["+("object"==typeof r?n:"")+"]";t(a,r,s,l)}});else if(!s&&"object"===h)n(a,function(e,n){t(i+"["+e+"]",n,s,l)});else l.push(e(i,a))}function i(e,i){e=e||{};var r=[];return n(e,function(e,n){t(e,n,i,r)}),r.join("&").replace(a,"+")}var n=require("./each"),r=require("./type"),o=/\[\]$/,a=/%20/g;return i}),define("eform-uploader/client/Transport",["require","eform-lang","eform-lang/inherits","eform-lang/param","./Runtime"],function(require){function e(e,i,n){n=t({},l,n),this.status=0,this.response=null,o.call(this,e,i,n)}var t=require("eform-lang").extend,i=require("eform-lang").each,n=require("eform-lang/inherits"),r=require("eform-lang/param"),o=require("./Runtime"),a=/#.*$/,s=/\?/,l={sendAsBinary:!1,url:"",data:{},headers:{},fileVal:"filename",name:"",method:"POST"};return e.prototype={initAjax:function(){var e=this,t=e.xhr=e.picker.register("XMLHttpRequest");return t.on("loadstart",function(){e.fire("load")}),t.on("progress uploadprogress",function(t){e.fire("progress",Math.min(1,Math.max(0,t.loaded/t.total)))}),t.on("load",function(){e.fire("progress",1);var i=e.status=t.exec("getStatus"),n=e.response=decodeURIComponent(t.exec("getResponse"));if(i>=200&&300>i||304===i)e.fire("complete",e.response);else if(i>=500&&600>i)e.fire("error",i,n);else e.fire("error",i,"http");t.dispose(),t=e.xhr=null}),t.on("error",function(){t.dispose(),t.off(),t=e.xhr=null,e.fire("error","http")}),t},send:function(e){var n,o=this.initAjax(),l=this.options,h=l.url.replace(a,null);if(l.sendAsBinary){var c=t({},{name:l.name,type:e.type},l.data);h+=(s.test(h)?"&":"?")+r(c),n=e.guid}else i(l.data,function(e,t){o.exec("append",e,t)}),o.exec("appendBlob",l.fileVal,e.guid,l.name);var d=t({"X-Requested-With":"XMLHttpRequest"},l.headers);i(d,function(e,t){o.exec("setRequestHeader",e,t)}),o.exec("send",{method:l.method,url:h,forceURLStream:!1,mimeType:e.type||"application/octet-stream"},n)},abort:function(){var e=this.xhr;if(e)e.exec("abort"),e.dispose(),this.xhr=e=null}},n(e,o),e}),define("eform-uploader/FilePicker",["require","eform-lang","eform-lang/format","eform-emitter","./client/Blob","./client/File","./client/Image","./client/Runtime","./client/MD5","./client/Transport"],function(require){function e(e){e=this.options=i({},s,e),this.guid=n(),this.main=e.main,this.clients={},this.flash=null,this.handlers=[],this.ready=!1,this.init(e)}var t=require("eform-lang").each,i=require("eform-lang").extend,n=require("eform-lang").guid,r=require("eform-lang/format"),o=require("eform-emitter"),a='<object id="jsreciver_${id}" type="application/x-shockwave-flash" data="${swf}" width="100%" height="100%" style="outline:0" '+(window.ActiveXObject?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':"")+'>    <param name="movie" value="${swf}"/>    <param name="flashvars" value="uid=${id}&jsreciver=jsreciver_${id}"/>    <param name="wmode" value="transparent"/>    <param name="allowscriptaccess" value="always"/></object>    ',s={accept:[{title:"Images",extensions:"gif,jpg,jpeg,bmp,png"}],multiple:!1,swf:"",main:null},l=[].slice;return e.prototype={constructor:e,init:function(e){function i(i,r){var o=i.type||i,a=o.split("::"),s=a[0];if(o=a[1],"Exception"===o)o="Error",i=r,r=null;if(s===n.guid){if("Ready"===o){if(!n.flash.exec)return;n.flash.exec(n.guid,"FilePicker","init",[{accept:e.accept,multiple:e.multiple}]),n.ready=!0,t(n.handlers,function(){n.exec.apply(n,this)}),n.handlers=[]}else if("Change"===o)t(n.exec(n.guid,"FilePicker","getFiles"),function(){n.fire("file",n.register("File",this))});else if("Cancel"!==o)n.fire(o.toLowerCase(),i,r)}else if(n.clients[s])n.clients[s].fire(o.toLowerCase(),i,r)}var n=this;n.main.innerHTML=r(a,{id:n.guid,swf:e.swf}),n.flash=n.main.firstChild,window["jsreciver_"+this.guid]=function(){var e=arguments;setTimeout(function(){i.apply(null,e)},1)}},enable:function(){this.exec(this.guid,"FilePicker","disable",!1)},disable:function(){this.exec(this.guid,"FilePicker","disable",!0)},dispose:function(){this.exec(this.guid,"FilePicker","destroy"),t(this.clients,function(){this.dispose()});try{delete window["jsreciver_"+this.guid]}catch(e){window["jsreciver_"+this.guid]=null}this.main.innerHTML="",this.main=this.flash=null},register:function(t,i){var n=e.clients[t]||e.clients.Runtime,r=new n(this,t,i);return this.clients[r.guid]=r,r},unregister:function(e){this.clients[e]&&delete this.clients[e]},exec:function(e,t,i,n){if(!this.ready)return this.handlers.push(l.call(arguments)),null;else return n=l.call(arguments,3),this.flash.exec(e,t,i,n)}},e.clients={Blob:require("./client/Blob"),File:require("./client/File"),Image:require("./client/Image"),Runtime:require("./client/Runtime"),MD5:require("./client/MD5"),Transport:require("./client/Transport")},o.mixin(e.prototype),e});